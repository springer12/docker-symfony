version: '2'

services:
    db:
        image: mysql:5
        ports:
            - 3306:3306
        volumes:
            - ${DB_DATA}:/var/lib/mysql
        environment:
            MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
            MYSQL_DATABASE: ${MYSQL_DATABASE}
            MYSQL_USER: ${MYSQL_USER}
            MYSQL_PASSWORD: ${MYSQL_PASSWORD}

    php:
        build: php7-fpm
        image: core23/symfony-php:${TAG:-latest}
        ports:
            - 9000:9000
        volumes:
            - ${CODE_DATA}:/var/www/symfony
        links:
            - db:mysqldb
        environment:
            SERVER_HOST: ${SERVER_HOST}

    nginx:
        build: nginx
        image: core23/symfony-nginx:${TAG-latest}
        ports:
            - 80:80
            - 443:443
        links:
            - php
        volumes_from:
            - php
            
    elk:
        build: elk
        image: core23/symfony-elk:${TAG-latest}
        ports:
            - 81:5601
        volumes_from:
            - php
            - nginx
